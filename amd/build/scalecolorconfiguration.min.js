define(["jquery","core/templates","core/ajax","core/notification","core/str","report_lpmonitoring/fieldsettoggler","report_lpmonitoring/bootstrap-colorpicker"],function(a,b,c,d,e,f){var g=function(b,c,d){this.frameworkSelector=b,this.scaleSelector=c,this.scaleValuesSelector=d,a(b).on("change",this.frameworkChangeHandler.bind(this)).change(),a(c).on("change",this.scaleChangeHandler.bind(this)).change(),a(document).on("submit","#savecolor",this.saveHandler.bind(this)),f.init()};return g.prototype.frameworkid=null,g.prototype.scaleid=null,g.prototype.frameworkSelector=null,g.prototype.scaleSelector=null,g.prototype.scaleValuesSelector=null,g.prototype.frameworkChangeHandler=function(b){var f,g=this;g.frameworkid=a(b.target).val(),""!==g.frameworkid?(a(g.scaleSelector).prop("disabled",!1),g.updateScaleHeader(),a("#loaderscale").show(),f=c.call([{methodname:"report_lpmonitoring_get_scales_from_framework",args:{competencyframeworkid:g.frameworkid}}]),f[0].done(function(b){g.buildScaleOptions(b),g.updateScaleHeader(),g.loadScaleConfiguration(),a("#loaderscale").hide(),a("#id_scale").show()}).fail(d.exception)):e.get_string("noscaleavailable","report_lpmonitoring").done(function(b){a(g.scaleSelector).prop("disabled",!0),a(g.scaleSelector+" option").remove(),a(g.scaleSelector).append(a("<option>").text(b).val("")),g.updateScaleHeader(),a("#loaderscale").hide(),a("#id_scale").hide()})},g.prototype.updateScaleHeader=function(){var b=document.getElementById("scaleselector"),c=b.options[b.selectedIndex].text;e.get_string("colorsforscale","report_lpmonitoring",c).done(function(b){a("#scaleheader").text(b)})},g.prototype.buildScaleOptions=function(b){var c=this;a(c.scaleSelector+" option").remove(),a.each(b,function(b,d){a(c.scaleSelector).append(a("<option>").text(d.name).val(d.id))}),c.scaleid=a(c.scaleSelector+" option:first-child").attr("value")},g.prototype.scaleChangeHandler=function(b){var c=this;c.scaleid=a(b.target).val(),c.scaleid?(a(c.scaleSelector).prop("disabled",!1),c.updateScaleHeader(),a("#loaderscalevalues").show(),c.loadScaleConfiguration()):(a(c.scaleValuesSelector).hide(),a("#loaderscalevalues").hide())},g.prototype.loadScaleConfiguration=function(){var e,f=this;a(".scalevalue").colorpicker("destroy"),a("#loaderscalevalues").show(),a("#submitScaleColorButton").prop("disabled",!0),a(f.scaleValuesSelector).hide(),e=c.call([{methodname:"report_lpmonitoring_read_report_competency_config",args:{competencyframeworkid:f.frameworkid,scaleid:f.scaleid}}]),e[0].done(function(c){return b.render("report_lpmonitoring/scalecolorconfigurationdetail",c).done(function(c,d){a(f.scaleValuesSelector).html(c),b.runTemplateJS(d),a("#loaderscalevalues").hide(),a(f.scaleValuesSelector).show(),a(".scalevalue").colorpicker(),a("#submitScaleColorButton").prop("disabled",!1)})}).fail(d.exception)},g.prototype.saveHandler=function(){var b,f,g=[],h=0,i="0",j=this;return h=1,a("#savecolor input[type=text]").each(function(){""!==a(this).val()&&(g.push({id:h,color:a(this).val()}),h++)}),g=JSON.stringify(g),i=a("#savecolor input[name=configid]").val(),b="0"===i?"report_lpmonitoring_create_report_competency_config":"report_lpmonitoring_update_report_competency_config",f=c.call([{methodname:b,args:{competencyframeworkid:j.frameworkid,scaleid:j.scaleid,scaleconfiguration:g}}]),f[0].done(function(b){"0"===i&&a("#savecolor input[name=configid]").val(b.id);var c=document.getElementById("scaleselector"),f=c.options[c.selectedIndex].text;e.get_string("colorsforscalesaved","report_lpmonitoring",f).done(function(b){a(".alert-success .close").trigger("click"),d.addNotification({message:b,type:"success"}),a("html, body").animate({scrollTop:0},500)}).fail(d.exception)}).fail(d.exception),!1},{init:function(a,b,c){return new g(a,b,c)}}});