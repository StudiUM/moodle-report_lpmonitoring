{"version":3,"sources":["../src/report_datatable.js"],"names":["define","$","DataTable","colorcontrast","ReportDataTable","tableSelector","reportfilterName","searchSelector","searchColumnsSelector","reportScaleSelector","coursesSelector","activitiesSelector","filterscalevalue","columns","self","document","ready","colorContrast","init","apply","texts","each","index","text","trim","indexOf","selected","append","push","on","performSearch","filterCoulmns","change","courseActivityFilter","show","prototype","table","search","draw","column","val","optionSelected","checkedvalue","classcolumn","courseormodule","columnheader","header","condition","hasClass","toggleClass","nodes","to$","value","removeClass","toLowerCase"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Apply dataTable on HTML table for report.\n *\n * @module     report_lpmonitoring/report_datatable\n * @author     Marie-Eve Lévesque <marie-eve.levesque.8@umontreal.ca>\n * @copyright  2019 Université de Montréal\n */\n\ndefine(['jquery',\n        'report_lpmonitoring/paginated_datatable',\n        'report_lpmonitoring/colorcontrast',\n        'report_lpmonitoring/jquery.dataTables'],\n        function ($, DataTable, colorcontrast) {\n\n            /**\n             * Constructor.\n             *\n             * @param {string} tableSelector The CSS selector used for the table.\n             * @param {string} reportfilterName The name of the filter radio buttons.\n             * @param {string} searchSelector The CSS selector used for the table search input.\n             * @param {string} searchColumnsSelector The CSS selector used for the table search input in course/activity.\n             * @param {string} reportScaleSelector The CSS selector used for the scale report input.\n             * @param {string} coursesSelector The CSS selector used for courses columns and cells.\n             * @param {string} activitiesSelector The CSS selector used for activities columns and cells.\n             * @param {string} filterscalevalue The filter scale value\n             */\n            var ReportDataTable = function(tableSelector, reportfilterName, searchSelector, searchColumnsSelector,\n            reportScaleSelector, coursesSelector, activitiesSelector, filterscalevalue) {\n                this.tableSelector = tableSelector;\n                this.reportfilterName = reportfilterName;\n                this.searchSelector = searchSelector;\n                this.searchColumnsSelector = searchColumnsSelector;\n                this.reportScaleSelector = reportScaleSelector;\n                this.coursesSelector = coursesSelector;\n                this.activitiesSelector = activitiesSelector;\n                this.columns = [];\n\n                var self = this;\n                // Perform the search and filters according to the actual values.\n                $(document).ready(function() {\n                    // Init the color contrast object.\n                    var colorContrast = colorcontrast.init();\n                    colorContrast.apply('td.evaluation a');\n\n                    DataTable.apply(self.tableSelector, false, false);\n                    // Filters.\n                    var texts = [''];\n                    $(self.tableSelector + \" thead tr th\").each(function( index ) {\n                        if (index > 1) {\n                            var indexdom = index + 1;\n                            $(tableSelector + ' tbody tr td:nth-of-type(' + indexdom + ')').each(function() {\n                                var text = $(this).text().trim();\n                                if (texts.indexOf(text) == -1) {\n                                    var selected = '';\n                                    if (text === filterscalevalue) {\n                                        selected = 'selected=\"true\"';\n                                    }\n                                    $(self.reportScaleSelector).append('<option value=\"' + text + '\"' + selected + '>'\n                                            + text + '</option>');\n                                    texts.push(text);\n                                }\n                            });\n                            self.columns.push(index);\n                        }\n                    });\n\n                    $(self.reportScaleSelector).on('change', function() {\n                        self.performSearch();\n                    });\n                    $(self.searchSelector).on('input', function() {\n                        self.performSearch();\n                    });\n                    $(self.searchColumnsSelector).on('input', function() {\n                        self.filterCoulmns();\n                        self.performSearch();\n                    });\n                    $('input[type=radio][name=' + self.reportfilterName + ']').change(function() {\n                        self.courseActivityFilter();\n                        self.performSearch();\n                    });\n\n                    $(tableSelector).show();\n                    self.courseActivityFilter();\n                    self.filterCoulmns();\n                    self.performSearch();\n                });\n            };\n\n            /** @var {String} The table CSS selector. */\n            ReportDataTable.prototype.tableSelector = null;\n            /** @var {String} The report filter name (for radio buttons). */\n            ReportDataTable.prototype.reportfilterName = null;\n            /** @var {String} The search input CSS selector. */\n            ReportDataTable.prototype.searchSelector = null;\n            /** @var {String} The search columns input CSS selector. */\n            ReportDataTable.prototype.searchColumnsSelector = null;\n            /** @var {String} The scale select CSS selector. */\n            ReportDataTable.prototype.reportScaleSelector = null;\n            /** @var {String} The courses cells CSS selector. */\n            ReportDataTable.prototype.coursesSelector = null;\n            /** @var {String} The activities (course modules) cells CSS selector. */\n            ReportDataTable.prototype.activitiesSelector = null;\n            /** @var {Array} The columns indexes. */\n            ReportDataTable.prototype.columns = [];\n\n            /**\n             * Perform the search and make sure the correct radio button is applied to the table (hide cells accordingly).\n             *\n             * @name   performSearch\n             * @return {Void}\n             * @function\n             */\n            ReportDataTable.prototype.performSearch = function() {\n                var table = $(this.tableSelector).DataTable();\n                table\n                 .search( '' )\n                 .columns().search( '' )\n                 .draw();\n                $(this.tableSelector).DataTable().column(0).search($(this.searchSelector).val(), false, false).draw();\n                var optionSelected = $(this.reportScaleSelector + ' option:selected').val();\n                $(this.tableSelector).DataTable().search(optionSelected, false, false).draw();\n            };\n\n            /**\n             * Switch display between course and activity\n             *\n             * @name   courseActivityFilter\n             * @return {Void}\n             * @function\n             */\n            ReportDataTable.prototype.courseActivityFilter = function() {\n                var self = this;\n                var checkedvalue = $('input[type=radio][name=' + self.reportfilterName + ']:checked').val();\n                var classcolumn = '';\n                var courseormodule = false;\n                if (checkedvalue === 'course') {\n                    classcolumn = 'course-cell';\n                    courseormodule = true;\n                }\n                else if (checkedvalue === 'module') {\n                    classcolumn = 'cm-cell';\n                    courseormodule = true;\n                }\n                if (courseormodule) {\n                    $(self.tableSelector + \" thead tr th\").each(function( index ) {\n                        if (index > 1) {\n                            var column = $(self.tableSelector).DataTable().column(index);\n                            var columnheader = column.header();\n                            var condition = $(this).hasClass(classcolumn);\n                            $(columnheader).toggleClass('switchsearchhidden', !condition);\n                            $(this).toggleClass('switchsearchhidden', !condition);\n                            column.nodes().to$().toggleClass('switchsearchhidden', !condition);\n                        }\n                    });\n                } else {\n                    $.each(self.columns, function(index, value) {\n                        var column = $(self.tableSelector).DataTable().column(value);\n                        var columnheader = column.header();\n                        $(columnheader).removeClass('switchsearchhidden');\n                        column.nodes().to$().removeClass('switchsearchhidden');\n                    });\n                }\n            };\n\n            /**\n             * Perform the search in th column.\n             *\n             * @name   filterCoulmn\n             * @return {Void}\n             * @function\n             */\n            ReportDataTable.prototype.filterCoulmns = function() {\n                var value = $(this.searchColumnsSelector).val().toLowerCase();\n                var self = this;\n                if (value !== '') {\n                    $(self.tableSelector + \" thead tr th\").each(function( index ) {\n                        if (index <= 1) {\n                            return true;\n                        }\n                        var column = $(self.tableSelector).DataTable().column(index);\n                        var columnheader = column.header();\n                        var condition = $(this).text().toLowerCase().indexOf(value) > -1;\n                        $(columnheader).toggleClass('filtersearchhidden', !condition);\n                        $(this).toggleClass('filtersearchhidden', !condition);\n                        column.nodes().to$().toggleClass('filtersearchhidden', !condition);\n                    });\n                } else {\n                    $.each(self.columns, function(index, value) {\n                        var column = $(self.tableSelector).DataTable().column(value);\n                        var columnheader = column.header();\n                        $(columnheader).removeClass('filtersearchhidden');\n                        column.nodes().to$().removeClass('filtersearchhidden');\n                    });\n                }\n            };\n\n            return {\n                init: function (tableSelector, reportfilterName, searchSelector,\n                    searchColumnsSelector, reportScaleSelector, coursesSelector, activitiesSelector, filterscalevalue) {\n                    return new ReportDataTable(tableSelector, reportfilterName, searchSelector,\n                        searchColumnsSelector, reportScaleSelector, coursesSelector, activitiesSelector, filterscalevalue);\n                }\n            };\n        });\n"],"file":"report_datatable.min.js"}