{"version":3,"sources":["../src/colorcontrast.js"],"names":["define","$","ColorContrast","colorContrastSelector","lightColorClassName","self","apply","prototype","luminance","r","g","b","a","map","v","Math","pow","each","bgc","css","parents","rgb","replace","split","luminancebackground","luminanceforeground","removeClass","addClass","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Color contrast.\n *\n * This script analyzes the elements of a selector and adds a class\n * for those whose background color is considered too dark.\n * The goal of applying lighter text color for these elements\n * to improve contrast.\n *\n * @module     report_lpmonitoring/colorcontrast\n * @author     Gilles-Philippe Leblanc <gilles-philippe.leblanc@umontreal.ca>\n * @copyright  2016 Université de Montréal\n */\n\ndefine(['jquery'],\n    function($) {\n\n        /**\n         * Color contrast object.\n         * @param {String} colorContrastSelector The selector of elements whose background color will be analyzed.\n         * @param {String} lightColorClassName The name of the class that will be added to the elements considered too dark.\n         */\n        var ColorContrast = function(colorContrastSelector, lightColorClassName) {\n            var self = this;\n\n            if (colorContrastSelector) {\n                self.colorContrastSelector = colorContrastSelector;\n            }\n\n            if (lightColorClassName) {\n                self.lightColorClassName = lightColorClassName;\n            }\n\n            self.apply();\n        };\n\n        /** @var {String} The color contrast selector. */\n        ColorContrast.prototype.colorContrastSelector = '.competencyreport .color-contrast';\n\n        /** @var {String} The light color class name. */\n        ColorContrast.prototype.lightColorClassName = 'light-color';\n\n        /**\n         * Calculate luminance ratio.\n         *\n         * @name   luminance\n         * @param {Number} r red\n         * @param {Number} g green\n         * @param {Number} b blue\n         * @return {Number}\n         * @function\n         */\n        ColorContrast.prototype.luminance = function (r, g, b) {\n            var a = [r,g,b].map(function(v) {\n                v /= 255;\n                return (v <= 0.03928) ? v / 12.92 : Math.pow( ((v + 0.055) / 1.055), 2.4 );\n            });\n            return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;\n        };\n\n        /**\n         * Apply the color contrast to desired selector.\n         *\n         * @name   apply\n         * @param {String} colorContrastSelector\n         * @return {Void}\n         * @function\n         */\n        ColorContrast.prototype.apply = function(colorContrastSelector) {\n            var self = this;\n            if (!colorContrastSelector) {\n                colorContrastSelector = self.colorContrastSelector;\n            }\n\n            $(colorContrastSelector).each(function() {\n                var bgc = $(this).css('background-color');\n\n                // Handle 100% transparent background.\n                if(bgc === 'transparent' || bgc === 'rgba(0, 0, 0, 0)') {\n                    // Scan each parent's background color looking at a non-transparent background.\n                    $(this).parents().each(function() {\n                        bgc = $(this).css('background-color');\n                        if (bgc !== 'transparent' && bgc !== 'rgba(0, 0, 0, 0)') {\n                            return false;\n                        }\n                    });\n                    // If all parents is transparent use default and go to next element.\n                    if(bgc === 'transparent' || bgc === 'rgba(0, 0, 0, 0)') {\n                        return true;\n                    }\n                }\n\n                // Extract RGB and convert it into luminance from the YIQ equation from https://www.w3.org/TR/AERT#color-contrast.\n                var rgb = bgc.replace(/^(rgb|rgba)\\(/,'').replace(/\\)$/,'').replace(/\\s/g,'').split(',');\n                var luminancebackground = self.luminance(rgb[0], rgb[1], rgb[2]);\n                var luminanceforeground = self.luminance(0, 0, 0);\n                var ratio = (luminancebackground + 0.05) / (luminanceforeground + 0.05);\n\n                if(ratio >= 4.5) {\n                    $(this).removeClass(self.lightColorClassName);\n                } else {\n                    $(this).addClass(self.lightColorClassName);\n                }\n            });\n        };\n\n        return {\n            /**\n             * Main initialisation.\n             *\n             * @param {String} colorContrastSelector The selector of elements whose background color will be analyzed.\n             * @param {String} lightColorClassName The name of the class that will be added to the elements considered too dark.\n             * @return {ColorContrast} A new instance of ColorContrast.\n             * @method init\n             */\n            init: function(colorContrastSelector, lightColorClassName) {\n                return new ColorContrast(colorContrastSelector, lightColorClassName);\n            }\n\n        };\n\n    });\n"],"file":"colorcontrast.min.js"}