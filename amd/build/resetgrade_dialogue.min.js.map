{"version":3,"sources":["../src/resetgrade_dialogue.js"],"names":["define","$","Notification","Templates","Dialogue","EventBase","Str","ResetGradeDialogue","allCompetencies","prototype","constructor","apply","Object","create","_popup","_afterRender","btnRate","_find","txtComment","click","e","preventDefault","_trigger","close","bind","val","display","strname","strmodule","_render","then","html","get_string","title","fail","exception","selector","getContent","find","context","allcompetencies","render"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Reset grade dialogue.\n *\n * @module     report_lpmonitoring/resetgrade_dialogue\n * @author     Marie-Eve Lévesque <marie-eve.levesque.8@umontreal.ca>\n * @copyright  2019 Université de Montréal\n */\n\ndefine(['jquery',\n    'core/notification',\n    'core/templates',\n    'tool_lp/dialogue',\n    'tool_lp/event_base',\n    'core/str'],\n    function($, Notification, Templates, Dialogue, EventBase, Str) {\n\n        /**\n         * Grade dialogue class.\n         * @param {Boolean} allCompetencies\n         */\n        var ResetGradeDialogue = function(allCompetencies) {\n            EventBase.prototype.constructor.apply(this, []);\n            this.allCompetencies = allCompetencies;\n        };\n        ResetGradeDialogue.prototype = Object.create(EventBase.prototype);\n\n        /** @var {Boolean} True if the popup is to reset all competencies, false for only one competency. */\n        ResetGradeDialogue.prototype.allCompetencies = false;\n\n        /** @type {Dialogue} The dialogue. */\n        ResetGradeDialogue.prototype._popup = null;\n\n        /**\n         * After render hook.\n         *\n         * @method _afterRender\n         * @protected\n         */\n        ResetGradeDialogue.prototype._afterRender = function() {\n            var btnRate = this._find('[data-action=\"reset\"]'),\n                txtComment = this._find('[name=\"comment\"]');\n\n            this._find('[data-action=\"cancel\"]').click(function(e) {\n                e.preventDefault();\n                this._trigger('cancelled');\n                this.close();\n            }.bind(this));\n\n            btnRate.click(function(e) {\n                e.preventDefault();\n                this._trigger('rated', {\n                    'note': txtComment.val()\n                });\n                this.close();\n            }.bind(this));\n        };\n\n        /**\n         * Close the dialogue.\n         *\n         * @method close\n         */\n        ResetGradeDialogue.prototype.close = function() {\n            if(this._popup !== null) {\n                this._popup.close();\n                this._popup = null;\n            }\n        };\n\n        /**\n         * Opens the reset grade dialogue.\n         *\n         * @method display\n         * @return {Promise}\n         */\n        ResetGradeDialogue.prototype.display = function() {\n            var strname = 'reset';\n            var strmodule = 'core';\n            if (this.allCompetencies) {\n                strname = 'resetallratings';\n                strmodule = 'report_lpmonitoring';\n            }\n            return this._render().then(function(html) {\n                return Str.get_string(strname, strmodule).then(function(title) {\n                    this._popup = new Dialogue(\n                        title,\n                        html,\n                        this._afterRender.bind(this),\n                        this.close.bind(this)\n                    );\n                }.bind(this));\n            }.bind(this)).fail(Notification.exception);\n        };\n\n        /**\n         * Find a node in the dialogue.\n         *\n         * @param {String} selector\n         * @method _find\n         * @returns {node} The node\n         * @protected\n         */\n        ResetGradeDialogue.prototype._find = function(selector) {\n            return $(this._popup.getContent()).find(selector);\n        };\n\n        /**\n         * Render the dialogue.\n         *\n         * @method _render\n         * @protected\n         * @return {Promise}\n         */\n        ResetGradeDialogue.prototype._render = function() {\n            var context = {};\n            context.allcompetencies = this.allCompetencies;\n            return Templates.render('report_lpmonitoring/competency_reset', context);\n        };\n\n        return ResetGradeDialogue;\n    });"],"file":"resetgrade_dialogue.min.js"}