{"version":3,"sources":["../src/summary_datatable.js"],"names":["define","$","DataTable","colorcontrast","SummaryDataTable","tableSelector","summaryfilterName","searchSelector","totalSelector","coursesSelector","activitiesSelector","self","document","ready","colorContrast","init","apply","on","performSearch","change","courseActivityFilter","summarySelectScale","show","prototype","column","search","val","draw","checkedvalue","classcolumn","each","index","columnheader","header","condition","hasClass","toggleClass","nodes","to$","optionSelected","data","parents","hide"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Apply dataTable on HTML table for summary.\n *\n * @module     report_lpmonitoring/summary_datatable\n * @author     Marie-Eve Lévesque <marie-eve.levesque.8@umontreal.ca>\n * @copyright  2019 Université de Montréal\n */\n\ndefine(['jquery', 'report_lpmonitoring/paginated_datatable', 'report_lpmonitoring/colorcontrast'],\n        function ($, DataTable, colorcontrast) {\n\n            /**\n             * Constructor.\n             *\n             * @param {string} tableSelector The CSS selector used for the table.\n             * @param {string} summaryfilterName The name of the filter radio buttons.\n             * @param {string} searchSelector The CSS selector used for the table search input.\n             * @param {string} totalSelector The CSS selector used for total.\n             * @param {string} coursesSelector The CSS selector used for courses columns and cells.\n             * @param {string} activitiesSelector The CSS selector used for activities columns and cells.\n             */\n            var SummaryDataTable = function(tableSelector, summaryfilterName, searchSelector, totalSelector, coursesSelector,\n            activitiesSelector) {\n                this.tableSelector = tableSelector;\n                this.summaryfilterName = summaryfilterName;\n                this.searchSelector = searchSelector;\n                this.totalSelector = totalSelector;\n                this.coursesSelector = coursesSelector;\n                this.activitiesSelector = activitiesSelector;\n\n                var self = this;\n                // Perform the search and filters according to the actual values.\n                $(document).ready(function() {\n                    // Init the color contrast object.\n                    var colorContrast = colorcontrast.init();\n                    colorContrast.apply('.summary-table .total-cell, .summary-table  .course-cell, .summary-table  .cm-cell');\n\n                    DataTable.apply(self.tableSelector, false, false);\n\n                    $(self.searchSelector).on('input', function() {\n                        self.performSearch();\n                    });\n\n                    $('input[type=radio][name=' + self.summaryfilterName + ']').change(function() {\n                        self.courseActivityFilter();\n                        self.performSearch();\n                    });\n\n                    $('#scale-filter-summary').on('change', function() {\n                        self.summarySelectScale();\n                    });\n\n                    $(tableSelector).show();\n                    self.courseActivityFilter();\n                    self.summarySelectScale();\n                    self.performSearch();\n                });\n            };\n\n            /** @var {String} The table CSS selector. */\n            SummaryDataTable.prototype.tableSelector = null;\n            /** @var {String} The report filter name (for radio buttons). */\n            SummaryDataTable.prototype.summaryfilterName = null;\n            /** @var {String} The search input CSS selector. */\n            SummaryDataTable.prototype.searchSelector = null;\n            /** @var {String} The total CSS selector. */\n            SummaryDataTable.prototype.totalSelector = null;\n            /** @var {String} The courses cells CSS selector. */\n            SummaryDataTable.prototype.coursesSelector = null;\n            /** @var {String} The activities (course modules) cells CSS selector. */\n            SummaryDataTable.prototype.activitiesSelector = null;\n\n            /**\n             * Perform the search in competency names (hide rows accordingly).\n             *\n             * @name   performSearch\n             * @return {Void}\n             * @function\n             */\n            SummaryDataTable.prototype.performSearch = function() {\n                $(this.tableSelector).DataTable().column(0).search($(this.searchSelector).val(), false, false).draw();\n            };\n\n            /**\n             * Switch display between course and activity.\n             *\n             * @name   courseActivityFilter\n             * @return {Void}\n             * @function\n             */\n            SummaryDataTable.prototype.courseActivityFilter = function() {\n                var self = this;\n                var checkedvalue = $('input[type=radio][name=' + self.summaryfilterName + ']:checked').val();\n                var classcolumn = '';\n                if (checkedvalue === 'course') {\n                    classcolumn = 'course-cell';\n                } else if (checkedvalue === 'module') {\n                    classcolumn = 'cm-cell';\n                } else {\n                    classcolumn = 'total-cell';\n                }\n                $(self.tableSelector + \" thead tr th\").each(function( index ) {\n                    if (index > 0) {\n                        var column = $(self.tableSelector).DataTable().column(index);\n                        var columnheader = column.header();\n                        var condition = $(this).hasClass(classcolumn);\n                        $(columnheader).toggleClass('switchsearchhidden', !condition);\n                        $(this).toggleClass('switchsearchhidden', !condition);\n                        column.nodes().to$().toggleClass('switchsearchhidden', !condition);\n                    }\n                });\n            };\n\n            /**\n             * Switch display between scales.\n             *\n             * @name   summarySelectScale\n             * @return {Void}\n             * @function\n             */\n            SummaryDataTable.prototype.summarySelectScale = function() {\n                var optionSelected = $('#scale-filter-summary').val();\n                if ($(this.tableSelector).data('scaleid') == optionSelected) {\n                    $(this.tableSelector).parents(\".table-scroll\").show();\n                    this.performSearch();\n                } else {\n                    $(this.tableSelector).parents(\".table-scroll\").hide();\n                }\n            };\n\n            return {\n                init: function (tableSelector, summaryfilterName, searchSelector, totalSelector, coursesSelector,\n                    activitiesSelector) {\n                        return new SummaryDataTable(tableSelector, summaryfilterName, searchSelector, totalSelector,\n                            coursesSelector, activitiesSelector);\n                }\n            };\n        });\n"],"file":"summary_datatable.min.js"}