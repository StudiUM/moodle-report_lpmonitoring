{"version":3,"sources":["../src/datatable_popup.js"],"names":["define","$","notification","str","ajax","templates","Dialogue","DatatablePopup","regionSelector","userCompetencySelector","on","_handleClick","bind","prototype","e","preventDefault","cell","target","competencyId","data","elementId","userId","type","requests","call","methodname","args","userid","competencyid","cmid","courseid","when","apply","then","context","_contextLoaded","catch","exception","self","displayuser","usercompetencysummary","cangrade","templatepath","coursemodule","render","done","html","js","get_string","title","runTemplateJS","destroyDialogue","fail","dialg","close"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Popup to view detail of competency for a user, for a course or course module.\n *\n * @package    report_lpmonitoring\n * @author     Marie-Eve Lévesque <marie-eve.levesque.8@umontreal.ca>\n * @copyright  2019 Université de Montréal\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or laterer\n */\n\ndefine(['jquery', 'core/notification', 'core/str', 'core/ajax', 'core/templates', 'tool_lp/dialogue'],\n        function($, notification, str, ajax, templates, Dialogue) {\n\n            /**\n             * DatatablePopup\n             *\n             * @param {String} regionSelector The regionSelector\n             * @param {String} userCompetencySelector The userCompetencySelector\n             */\n            var DatatablePopup = function(regionSelector, userCompetencySelector) {\n                $(regionSelector).on('click', userCompetencySelector, this._handleClick.bind(this));\n            };\n\n            /**\n             * Get the data from the clicked cell and open the popup.\n             *\n             * @method _handleClick\n             * @param {Event} e The event\n             */\n            DatatablePopup.prototype._handleClick = function(e) {\n                // Do not scroll to top.\n                e.preventDefault();\n\n                var cell = $(e.target);\n                var competencyId = $(cell).data('competencyid');\n                var elementId = $(cell).data('elementid');\n                var userId = $(cell).data('userid');\n                var type = $(cell).data('type');\n\n                if (type == 'cm') {\n                    var requests = ajax.call([{\n                        methodname: 'tool_cmcompetency_data_for_user_competency_summary_in_coursemodule',\n                        args: {userid: userId, competencyid: competencyId, cmid: elementId},\n                    }, {\n                        methodname: 'tool_cmcompetency_user_competency_viewed_in_coursemodule',\n                        args: {userid: userId, competencyid: competencyId, cmid: elementId},\n                    }]);\n                } else {\n                    var requests = ajax.call([{\n                        methodname: 'report_lpmonitoring_data_for_user_competency_summary_in_course',\n                        args: {userid: userId, competencyid: competencyId, courseid: elementId},\n                    }, {\n                        methodname: 'report_lpmonitoring_user_competency_viewed_in_course',\n                        args: {userid: userId, competencyid: competencyId, courseid: elementId},\n                    }]);\n                }\n\n                $.when.apply($, requests).then(function(context) {\n                    this._contextLoaded.bind(this)(context);\n                    return;\n                }.bind(this)).catch(notification.exception);\n            };\n\n            /**\n             * We loaded the context, now render the template.\n             *\n             * @method _contextLoaded\n             * @param {Object} context\n             */\n            DatatablePopup.prototype._contextLoaded = function(context) {\n                var self = this;\n                // We have to display user info in popup.\n                context.displayuser = true;\n                // Impossible to grade course directly in this popup.\n                context.usercompetencysummary.cangrade = false;\n\n                var templatepath = 'tool_lp/user_competency_summary_in_course';\n                if (typeof context.coursemodule !== 'undefined') {\n                    templatepath = 'report_cmcompetency/user_competency_summary_in_coursemodule';\n                }\n                templates.render(templatepath, context).done(function(html, js) {\n                    str.get_string('usercompetencysummary', 'report_competency').done(function(title) {\n                        (new Dialogue(title, html, templates.runTemplateJS.bind(templates, js), self.destroyDialogue, true));\n                    }).fail(notification.exception);\n                }).fail(notification.exception);\n            };\n\n            /**\n             * Destroy DOM after close.\n             *\n             * @param Dialogue\n             * @function\n             */\n            DatatablePopup.prototype.destroyDialogue = function(dialg) {\n                dialg.close();\n            };\n\n            return DatatablePopup;\n\n        });\n"],"file":"datatable_popup.min.js"}