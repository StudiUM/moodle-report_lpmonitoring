define(["jquery","core/notification","core/str","core/ajax","core/templates","tool_lp/dialogue"],function(a,b,c,d,e,f){var g=function(b,c,d){var e=this;e.planid=d,e.selector_nbcomments=c,a(b).on("click",this.handleClick.bind(this))};return g.prototype.planid=-1,g.prototype.selector_nbcomments="",g.prototype.selector_commentlist=".moodle-dialogue-wrap .comment-list",g.prototype.popup=null,g.prototype.actual_size=0,g.prototype.handleClick=function(a){a.preventDefault();var c=this;d.call([{methodname:"report_lpmonitoring_get_comment_area_for_plan",args:{planid:c.planid},done:c.commentareaLoaded.bind(c),fail:b.exception}])},g.prototype.commentareaLoaded=function(d){var g=this;e.render("report_lpmonitoring/comment_area",d).done(function(d,e){c.get_string("commentsedit","report_lpmonitoring").done(function(b){g.popup=new f(b,d,g.open.bind(g,e),g.close.bind(g),(!0)),a("body").on("DOMSubtreeModified",g.selector_commentlist,g.checkPopupSize.bind(g))}).fail(b.exception)}).fail(b.exception)},g.prototype.open=function(a){e.runTemplateJS(a)},g.prototype.close=function(){var c=this,e=d.call([{methodname:"report_lpmonitoring_get_comment_area_for_plan",args:{planid:c.planid},fail:b.exception}]);e[0].then(function(b){a(c.selector_nbcomments).text(b.count)}),a("body").off("DOMSubtreeModified",c.selector_commentlist),c.popup.close(),c.popup=null},g.prototype.checkPopupSize=function(){var b=this,c=a(b.selector_commentlist).height();if(c>b.actual_size){var d=b.popup.yuiDialogue.get("boundingBox");a(".moodle-dialogue").height()>d.get("winHeight")&&(d.addClass("moodle-dialogue-fullscreen"),d.setStyles({left:null,top:null,width:null,height:null,right:null,bottom:null}))}b.actual_size=c},{init:function(a,b,c){return new g(a,b,c)}}});