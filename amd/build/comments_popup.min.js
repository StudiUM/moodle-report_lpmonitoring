define ("report_lpmonitoring/comments_popup",["jquery","core/notification","core/str","core/ajax","core/templates","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){var h=function(b,c,d){var e=this;e.planid=d;e.selector_nbcomments=c;a(b).on("click",this.handleClick.bind(this))};h.prototype.planid=-1;h.prototype.selector_nbcomments="";h.prototype.popup=null;h.prototype.actual_size=0;h.prototype.handleClick=function(c){c.preventDefault();var e=a(c.target),f=this,g=d.call([{methodname:"report_lpmonitoring_get_comment_area_for_plan",args:{planid:f.planid}}]);a.when.apply(a,g).then(function(a){f.commentareaLoaded.bind(this)(a,e)}.bind(this)).catch(b.exception)};h.prototype.commentareaLoaded=function(a,d){var h=this;return c.get_string("commentsedit","report_lpmonitoring").done(function(b){return f.create({type:f.types.DEFAULT,title:b,body:e.render("report_lpmonitoring/comment_area",a),large:!0}).done(function(a){h.popup=a;a.getRoot().on(g.hidden,function(){h.close();h.focusContentItem(d)}.bind(this));h.popup.show()}.bind(this))}).fail(b.exception)};h.prototype.focusContentItem=function(a){if(a.is("input:not([type=\"hidden\"]), a[href], button, textarea, select, [tabindex]")){a.focus()}else{a.find("input:not([type=\"hidden\"]), a[href], button, textarea, select, [tabindex]").first().focus()}};h.prototype.open=function(a){e.runTemplateJS(a)};h.prototype.close=function(){var c=this,e=d.call([{methodname:"report_lpmonitoring_get_comment_area_for_plan",args:{planid:c.planid},fail:b.exception}]);e[0].then(function(b){a(c.selector_nbcomments).text(b.count)});c.popup.destroy();c.popup=null};return{init:function init(a,b,c){return new h(a,b,c)}}});
//# sourceMappingURL=comments_popup.min.js.map
