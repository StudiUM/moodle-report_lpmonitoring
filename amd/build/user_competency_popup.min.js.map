{"version":3,"sources":["../src/user_competency_popup.js"],"names":["define","$","notification","str","ajax","templates","Dialogue","UserCompetencyPopup","regionSelector","userCompetencySelector","_regionSelector","_userCompetencySelector","_competencyId","_planId","_userId","on","_handleClick","bind","prototype","e","preventDefault","self","cell","target","closest","data","requests","call","methodname","args","competencyid","planid","done","_contextLoaded","fail","exception","then","result","eventMethodName","plan","iscompleted","userid","context","render","html","js","get_string","title","popup","runTemplateJS","_refresh","close"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to enable inline editing of a comptency grade.\n *\n * @package    report_lpmonitoring\n * @author     Jean-Philippe Gaudreau <jp.gaudreau@umontreal.ca>\n * @copyright  2016 Université de Montréal\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery',\n        'core/notification',\n        'core/str',\n        'core/ajax',\n        'core/templates',\n        'tool_lp/dialogue'],\n    function($, notification, str, ajax, templates, Dialogue) {\n\n        /**\n         * UserCompetencyPopup\n         *\n         * @param {String} The regionSelector\n         * @param {String} The userCompetencySelector\n         */\n        var UserCompetencyPopup = function(regionSelector, userCompetencySelector) {\n            this._regionSelector = regionSelector;\n            this._userCompetencySelector = userCompetencySelector;\n            this._competencyId = null;\n            this._planId = null;\n            this._userId = null;\n\n            $(this._regionSelector).on('click', this._userCompetencySelector, this._handleClick.bind(this));\n        };\n\n        /**\n         * Get the data from the clicked cell and open the popup.\n         *\n         * @method _handleClick\n         * @param {Event} e\n         */\n        UserCompetencyPopup.prototype._handleClick = function(e) {\n            e.preventDefault();\n            var self = this;\n            var cell = $(e.target).closest(this._userCompetencySelector);\n            self._competencyId = $(cell).data('competencyid');\n            self._planId = $(cell).data('planid');\n            self._userId = $(cell).data('userid');\n\n            var requests = ajax.call([{\n                methodname : 'tool_lp_data_for_user_competency_summary_in_plan',\n                args: { competencyid: self._competencyId , planid: self._planId },\n                done: self._contextLoaded.bind(self),\n                fail: notification.exception\n            }]);\n\n            // Log the user competency viewed in plan event.\n            requests[0].then(function (result) {\n                var eventMethodName = 'core_competency_user_competency_viewed_in_plan';\n                // Trigger core_competency_user_competency_plan_viewed event instead if plan is already completed.\n                if (result.plan.iscompleted) {\n                    eventMethodName = 'core_competency_user_competency_plan_viewed';\n                }\n                ajax.call([{\n                    methodname: eventMethodName,\n                    args: {competencyid: self._competencyId, userid: self._userId, planid: self._planId},\n                    fail: notification.exception\n                }]);\n            });\n        };\n\n        /**\n         * We loaded the context, now render the template.\n         *\n         * @method _contextLoaded\n         * @param {Object} context\n         */\n        UserCompetencyPopup.prototype._contextLoaded = function(context) {\n            var self = this;\n            // We have to display user info in popup.\n            templates.render('tool_lp/user_competency_summary_in_plan', context).done(function(html, js) {\n                str.get_string('usercompetencysummary', 'report_competency').done(function(title) {\n                    self.popup = new Dialogue(title, html, templates.runTemplateJS.bind(templates, js),\n                        self._refresh.bind(self), true);\n                }).fail(notification.exception);\n            }).fail(notification.exception);\n        };\n\n        /**\n         * @var {Dialogue} popup  The popup window (Dialogue).\n         * @private\n         */\n        UserCompetencyPopup.prototype.popup = null;\n\n        /**\n         * Destroy DOM after close.\n         *\n         * @param Dialogue\n         * @function\n         */\n        UserCompetencyPopup.prototype.close = function() {\n            this.popup.close();\n            this.popup = null;\n        };\n\n        /**\n         * Refresh the page.\n         *\n         * @method _refresh\n         */\n        UserCompetencyPopup.prototype._refresh = function() {};\n\n        return  UserCompetencyPopup;\n    });"],"file":"user_competency_popup.min.js"}