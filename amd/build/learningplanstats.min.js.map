{"version":3,"sources":["../src/learningplanstats.js"],"names":["define","$","templates","ajax","notification","str","Chart","autocomplete","Toggler","colorcontrast","ModalFactory","ModalEvents","DataTable","LearningplanStats","initPage","colorContrast","init","templateSelector","on","templateChangeHandler","bind","change","prototype","templateId","competencies","e","self","target","val","removeAttr","attr","submitFormHandler","loadListCompetencies","templateid","ratingtype","is","promiselistCompetencies","call","methodname","args","id","elementloading","addClass","then","results","length","render","competencies_list","done","html","js","runTemplateJS","removeClass","loadCompetenciesDetails","fail","exp","exception","getCompetencyDetailDeferred","request","templatename","defer","Deferred","promiserequest","context","compid","competencyid","competencydetail","colors","datascales","applygraph","nbuserrated","each","scalecompetencyitems","index","record","push","color","nbusers","nbratings","type","data","labels","datasets","backgroundColor","hoverBackgroundColor","options","legend","responsive","tooltips","enabled","apply","resolve","empty","promise","servicename","base","when","infocompetency","req","displayScaleUserList","listusers","scalevalue","trigger","scalecompetencyitem","get_string","title","create","types","DEFAULT","body","large","modal","getRoot","hidden","destroy","focusContentItem","bodyRendered","show","displayTotalUserList","totaluserlist","item","focus","find","first","get_strings","key","component","strings","enhance","document","event","preventDefault","closest","users","processResults","selector","template","value","label","_label","transport","query","success","failure","contextid","parseInt","promises","i","arguments"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Learning plan stats.\n *\n * @module     report_lpmonitoring/learningplanstats\n * @author     Issam Taboubi <issam.taboubi@umontreal.ca>\n * @copyright  2016 Université de Montréal\n */\n\ndefine(['jquery',\n    'core/templates',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/chartjs',\n    'core/form-autocomplete',\n    'report_lpmonitoring/fieldsettoggler',\n    'report_lpmonitoring/colorcontrast',\n    'core/modal_factory',\n    'core/modal_events',\n    'report_lpmonitoring/paginated_datatable'],\n    function($, templates, ajax, notification, str, Chart, autocomplete, Toggler,\n            colorcontrast, ModalFactory, ModalEvents, DataTable) {\n\n        /**\n         * Learning plan stats.\n         */\n        var LearningplanStats = function() {\n\n            // Init the form filter.\n            this.initPage();\n\n            // Init the color contrast object.\n            this.colorContrast = colorcontrast.init();\n\n            // Template change Handler.\n            $(this.templateSelector).on('change', this.templateChangeHandler.bind(this)).change();\n        };\n\n        /** @var {String} The template select box selector. */\n        LearningplanStats.prototype.templateSelector = \"#templateSelectorStats\";\n        /** @var {String} The template ID. */\n        LearningplanStats.prototype.templateId = null;\n        /** @var {Array} Competencies informations. */\n        LearningplanStats.prototype.competencies = {};\n        /** @var {ColorContrast} ColorContrast object instance. */\n        LearningplanStats.prototype.colorcontrast = null;\n\n        /**\n         * Triggered when a template is selected.\n         *\n         * @name   templateChangeHandler\n         * @param  {Event} e\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.templateChangeHandler = function(e) {\n            var self = this;\n            self.templateId = $(e.target).val();\n\n            if (self.templateId) {\n                $('#submitFilterStatstButton').removeAttr('disabled');\n            } else {\n                $('#submitFilterStatstButton').attr('disabled', 'disabled');\n            }\n        };\n\n        /**\n         * Submit filter form.\n         *\n         * @name   submitFormHandler\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.submitFormHandler = function() {\n            var self = this;\n            if (self.templateId) {\n                self.loadListCompetencies(self.templateId);\n            }\n        };\n\n        /**\n         * Load list of competencies of a specified template.\n         *\n         * @name   loadListCompetencies\n         * @param  {Number} templateid\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.loadListCompetencies = function(templateid) {\n            var self = this, ratingtype = 'course';\n\n            if ($(\"#ratinginplanoption\").is(':checked')) {\n                ratingtype = 'plan';\n            } else if ($(\"#ratingincoursemoduleoption\").is(':checked')) {\n                ratingtype = 'coursemodule';\n            }\n\n            var promiselistCompetencies = ajax.call([{\n                methodname: 'core_competency_list_competencies_in_template',\n                args: {\n                    id: templateid\n                }\n            }]);\n            var elementloading = $(\"#submitFilterStatstButton\");\n            elementloading.addClass('loading');\n            promiselistCompetencies[0].then(function(results) {\n                if (results.length > 0) {\n                    var competencies = {competencies_list:results};\n                    return templates.render('report_lpmonitoring/list_competencies_stats', competencies).done(function(html, js) {\n                        $(\"#list-competencies-template\").html(html);\n                        templates.runTemplateJS(js);\n                        elementloading.removeClass('loading');\n                        self.loadCompetenciesDetails(results, templateid, ratingtype);\n                    });\n                } else {\n                    elementloading.removeClass('loading');\n                    return templates.render('report_lpmonitoring/list_competencies_stats', {}).done(function(html, js) {\n                        $(\"#list-competencies-template\").html(html);\n                        templates.runTemplateJS(js);\n                    });\n                }\n            }).fail(\n                function(exp) {\n                    elementloading.removeClass('loading');\n                    notification.exception(exp);\n                }\n            );\n        };\n\n        /**\n         * Get competency detail.\n         *\n         * @name  getCompetencyDetailDeferred\n         * @param {Object} request\n         * @param {String} templatename\n         * @param {String} ratingtype 'course', 'coursemodule' or 'plan'\n         * @return {Object} promise\n         * @function\n         */\n        LearningplanStats.prototype.getCompetencyDetailDeferred = function(request, templatename, ratingtype) {\n            var self = this;\n            return function() {\n                // Wrap with a deferred.\n                var defer = $.Deferred();\n                var promiserequest = ajax.call(request);\n                promiserequest[0].done(function(context){\n                    var compid = context.competencyid;\n                    // Locally store competency statitstics.\n                    self.competencies[compid].competencydetail = context;\n                    templates.render(templatename, context).done(function(html, js) {\n                        $('#comp-' + compid).removeClass('loading');\n                        $('#comp-' + compid + ' .x_content').html(html);\n                        // Apply Donut Graph to the competency.\n                        var options = {\n                            legend: false,\n                            responsive: false,\n                            tooltips: {enabled: false}\n                        };\n                        var colors = [];\n                        var datascales = [];\n                        var applygraph = false;\n                        if (ratingtype === 'plan' && context.nbuserrated !== 0) {\n                            $.each(context.scalecompetencyitems, function(index, record) {\n                                colors.push(record.color);\n                                datascales.push(record.nbusers);\n                            });\n                            applygraph = true;\n                        }\n                        if ( (ratingtype === 'course' || ratingtype === 'coursemodule') && context.nbratings !== 0) {\n                            $.each(context.scalecompetencyitems, function(index, record) {\n                                colors.push(record.color);\n                                datascales.push(record.nbratings);\n                            });\n                            applygraph = true;\n                        }\n                        if (applygraph === true) {\n                            new Chart($('#canvas-graph-' + compid), {\n                                type: 'doughnut',\n                                data: {\n                                    labels: [],\n                                    datasets: [{\n                                        data: datascales,\n                                        backgroundColor: colors,\n                                        hoverBackgroundColor: []\n                                    }]\n                                },\n                                options: options\n                            });\n                        }\n                        templates.runTemplateJS(js);\n                        self.colorContrast.apply('#comp-' + compid + ' .x_content .tile-stats .badge.cr-scalename');\n                    });\n                    defer.resolve();\n                }).fail(function(exp) {\n                    $(\"#list-competencies-template\").empty();\n                    notification.exception(exp);\n                });\n                // Return a promise so that we can chain properly in the each.\n                return defer.promise();\n            };\n        };\n\n        /**\n         * Load competencies details.\n         *\n         * @name  loadCompetenciesDetails\n         * @param {Object[]} competencies\n         * @param {Number} templateid\n         * @param {String} ratingtype 'course', 'coursemodule' or 'plan'\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.loadCompetenciesDetails = function(competencies, templateid, ratingtype) {\n            var self = this;\n            var servicename = 'report_lpmonitoring_get_competency_statistics';\n            var templatename = 'report_lpmonitoring/competency_detail_stats';\n            if (ratingtype == 'course') {\n                servicename = 'report_lpmonitoring_get_competency_statistics_incourse';\n                templatename = 'report_lpmonitoring/competency_detail_stats_incourse';\n            } else if (ratingtype == 'coursemodule') {\n                servicename = 'report_lpmonitoring_get_competency_statistics_incoursemodules';\n                templatename = 'report_lpmonitoring/competency_detail_stats_incourse';\n            }\n            var base = $.when({});\n            $('.competencyreport .competency-detail').addClass('loading');\n            $.each(competencies, function(index, record) {\n                // Locally store competency information.\n                self.competencies[record.id] = {infocompetency: record};\n                var req = [{\n                    methodname: servicename,\n                    args: {\n                        competencyid: record.id,\n                        templateid: templateid\n                    }\n                }];\n                base = base.then(self.getCompetencyDetailDeferred(req, templatename, ratingtype));\n            });\n        };\n\n        /**\n         * Display the list of users in competency.\n         *\n         * @name   displayScaleUserList\n         * @param  {Array} listusers\n         * @param  {Number} competencyid\n         * @param  {Number} scalevalue\n         * @param  {Object} trigger\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.displayScaleUserList = function(listusers, competencyid, scalevalue, trigger) {\n            var self = this;\n            listusers.competencyid = competencyid;\n            listusers.scalevalue = scalevalue;\n            if (listusers.scalecompetencyitem.listusers.length > 0) {\n                str.get_string('linkedusers', 'report_lpmonitoring').done(function(title) {\n                    ModalFactory.create({\n                        type: ModalFactory.types.DEFAULT,\n                        title: title,\n                        body: templates.render('report_lpmonitoring/list_users_in_scale_value', listusers),\n                        large: true\n                    }).done(function(modal) {\n                        // Keep a reference to the modal.\n                        modal.getRoot().on(ModalEvents.hidden, function() {\n                            modal.destroy();\n                            self.focusContentItem(trigger);\n                        }.bind(this));\n                        modal.getRoot().on(ModalEvents.bodyRendered, function() {\n                            DataTable.apply('#list-user-' + competencyid + '-' + scalevalue, true, true);\n                            self.colorContrast.apply('.moodle-dialogue-base .badge.cr-scalename');\n                        }.bind(this));\n                        modal.show();\n                    }.bind(this));\n                }).fail(notification.exception);\n            }\n        };\n\n        /**\n         * Display the list of users in competency.\n         *\n         * @name   displayTotalUserList\n         * @param  {Array} listusers\n         * @param  {Object} trigger\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.displayTotalUserList = function(listusers, trigger) {\n            var self = this;\n            if (listusers.totaluserlist.length > 0) {\n                str.get_string('userlist').done(function(title) {\n                    ModalFactory.create({\n                        type: ModalFactory.types.DEFAULT,\n                        title: title,\n                        body: templates.render('report_lpmonitoring/list_users_in_competency_stats', listusers),\n                        large: true\n                    }).done(function(modal) {\n                        // Keep a reference to the modal.\n                        modal.getRoot().on(ModalEvents.hidden, function() {\n                            modal.destroy();\n                            self.focusContentItem(trigger);\n                        }.bind(this));\n                        modal.getRoot().on(ModalEvents.bodyRendered, function() {\n                            DataTable.apply('#list-users-stats-' + listusers.competencyid, true, true);\n                            self.colorContrast.apply('.moodle-dialogue-base .badge.cr-scalename');\n                        }.bind(this));\n                        modal.show();\n                    }.bind(this));\n                }).fail(notification.exception);\n            }\n        };\n\n        /**\n         * Focus the given content item or the first focusable element within\n         * the content item.\n         *\n         * @method focusContentItem\n         * @param {object} item The content item jQuery element\n         */\n        LearningplanStats.prototype.focusContentItem = function(item) {\n            var focusable = 'input:not([type=\"hidden\"]), a[href], button, textarea, select, [tabindex]';\n            if (item.is(focusable)) {\n                item.focus();\n            } else {\n                item.find(focusable).first().focus();\n            }\n        };\n\n        /**\n         * Init the differents page blocks and inputs form.\n         *\n         * @name   initPage\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.initPage = function() {\n            var self = this;\n            str.get_strings([\n                { key: 'selectlearningplantemplate', component: 'report_lpmonitoring' },\n                { key: 'notemplateselected', component: 'report_lpmonitoring' }]\n            ).done(\n                function (strings) {\n                    // Autocomplete for templates.\n                    autocomplete.enhance(\n                        self.templateSelector,\n                        false,\n                        'report_lpmonitoring/learningplanstats',\n                        strings[0],\n                        false,\n                        true,\n                        strings[1]);\n                }\n            ).fail(notification.exception);\n\n            // Allow collapse of block panels.\n            Toggler.init();\n\n            // Filter form submit.\n            $(document).on('submit', '#statstFilter', function(){\n                self.submitFormHandler();\n                return false;\n            });\n\n            // Handle click on scale number users.\n            $(\".competencyreport\").on('click', 'a.scaleinfo', function(event) {\n                event.preventDefault();\n                var trigger = $(event.target).closest('td');\n                var competencyid = $(this).data(\"competencyid\");\n                var scalevalue = $(this).data(\"scalevalue\");\n\n                if (typeof self.competencies[competencyid] !== 'undefined') {\n                    var listusers = {};\n                    var competencydetail = self.competencies[competencyid].competencydetail;\n                    listusers.scalecompetencyitem = competencydetail.scalecompetencyitems[scalevalue - 1];\n                    self.displayScaleUserList(listusers, competencyid, scalevalue, trigger);\n                }\n            });\n            // Handle click on total users.\n            $(\".competencyreport\").on('click', 'a.totalnbusers', function(event) {\n                event.preventDefault();\n                var competencyid = $(this).data(\"competencyid\");\n                var trigger = $(event.target);\n                if (typeof self.competencies[competencyid] !== 'undefined') {\n                    var users = {};\n                    users.totaluserlist = self.competencies[competencyid].competencydetail.totaluserlist;\n                    users.competencyid = competencyid;\n                    self.displayTotalUserList(users, trigger);\n                }\n            });\n        };\n\n        return {\n            /**\n             * Main initialisation.\n             *\n             * @return {LearningplanStats}\n             * @method init\n             */\n            init: function() {\n                return new LearningplanStats();\n            },\n            /**\n             * Process result autocomplete for templates.\n             *\n             * @param {type} selector\n             * @param {type} results\n             * @returns {Array}\n             */\n            processResults: function(selector, results) {\n                var templates = [];\n                $.each(results, function(index, template) {\n                    templates.push({\n                        value: template.id,\n                        label: template._label\n                    });\n                });\n                return templates;\n            },\n\n            /**\n             * Transport method for autocomplete for templates.\n             *\n             * @param {type} selector\n             * @param {type} query\n             * @param {type} success\n             * @param {type} failure\n             * @returns {undefined}\n             */\n            transport: function(selector, query, success, failure) {\n                var promise;\n                var contextid = $(selector).data('contextid');\n                if (contextid === '') {\n                    return [];\n                }\n\n                promise = ajax.call([{\n                    methodname: 'report_lpmonitoring_search_templates',\n                    args: {\n                        query: query,\n                        contextid: parseInt(contextid)\n                    }\n                }]);\n\n                promise[0].then(function(results) {\n                    var promises = [],\n                        i = 0;\n\n                    // Render the label.\n                    $.each(results, function(index, template) {\n                        promises.push(templates.render('report_lpmonitoring/form-template-selector-suggestion', template));\n                    });\n\n                    // Apply the label to the results.\n                    return $.when.apply($.when, promises).then(function() {\n                        var args = arguments;\n                        $.each(results, function(index, template) {\n                            template._label = args[i];\n                            i++;\n                        });\n                        success(results);\n                    });\n\n                }, failure);\n            }\n        };\n\n    });\n"],"file":"learningplanstats.min.js"}