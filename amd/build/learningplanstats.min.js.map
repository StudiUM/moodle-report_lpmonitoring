{"version":3,"sources":["../src/learningplanstats.js"],"names":["define","$","templates","ajax","notification","str","Chart","autocomplete","Toggler","colorcontrast","Dialogue","DataTable","LearningplanStats","initPage","colorContrast","init","templateSelector","on","templateChangeHandler","bind","change","prototype","templateId","competencies","e","self","target","val","removeAttr","attr","submitFormHandler","loadListCompetencies","templateid","ratingtype","is","promiselistCompetencies","call","methodname","args","id","elementloading","addClass","then","results","length","render","competencies_list","done","html","js","runTemplateJS","removeClass","loadCompetenciesDetails","fail","exp","exception","getCompetencyDetailDeferred","request","templatename","defer","Deferred","promiserequest","context","compid","competencyid","competencydetail","colors","datascales","applygraph","nbuserrated","each","scalecompetencyitems","index","record","push","color","nbusers","nbratings","type","data","labels","datasets","backgroundColor","hoverBackgroundColor","options","legend","responsive","tooltips","enabled","apply","resolve","empty","promise","servicename","base","when","infocompetency","req","displayScaleUserList","listusers","scalevalue","scalecompetencyitem","get_string","titledialogue","destroyDialogue","displayTotalUserList","totaluserlist","dialg","close","get_strings","key","component","strings","enhance","document","event","preventDefault","users","processResults","selector","template","value","label","_label","transport","query","success","failure","contextid","parseInt","promises","i","arguments"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Learning plan stats.\n *\n * @package    report_lpmonitoring\n * @author     Issam Taboubi <issam.taboubi@umontreal.ca>\n * @copyright  2016 Université de Montréal\n */\n\ndefine(['jquery',\n    'core/templates',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/chartjs',\n    'core/form-autocomplete',\n    'report_lpmonitoring/fieldsettoggler',\n    'report_lpmonitoring/colorcontrast',\n    'tool_lp/dialogue',\n    'report_lpmonitoring/paginated_datatable'],\n    function($, templates, ajax, notification, str, Chart, autocomplete, Toggler,\n            colorcontrast, Dialogue, DataTable) {\n\n        /**\n         * Learning plan stats.\n         */\n        var LearningplanStats = function() {\n\n            // Init the form filter.\n            this.initPage();\n\n            // Init the color contrast object.\n            this.colorContrast = colorcontrast.init();\n\n            // Template change Handler.\n            $(this.templateSelector).on('change', this.templateChangeHandler.bind(this)).change();\n        };\n\n        /** @var {String} The template select box selector. */\n        LearningplanStats.prototype.templateSelector = \"#templateSelectorStats\";\n        /** @var {String} The template ID. */\n        LearningplanStats.prototype.templateId = null;\n        /** @var {Array} Competencies informations. */\n        LearningplanStats.prototype.competencies = {};\n        /** @var {ColorContrast} ColorContrast object instance. */\n        LearningplanStats.prototype.colorcontrast = null;\n\n        /**\n         * Triggered when a template is selected.\n         *\n         * @name   templateChangeHandler\n         * @param  {Event} e\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.templateChangeHandler = function(e) {\n            var self = this;\n            self.templateId = $(e.target).val();\n\n            if (self.templateId) {\n                $('#submitFilterStatstButton').removeAttr('disabled');\n            } else {\n                $('#submitFilterStatstButton').attr('disabled', 'disabled');\n            }\n        };\n\n        /**\n         * Submit filter form.\n         *\n         * @name   submitFormHandler\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.submitFormHandler = function() {\n            var self = this;\n            if (self.templateId) {\n                self.loadListCompetencies(self.templateId);\n            }\n        };\n\n        /**\n         * Load list of competencies of a specified template.\n         *\n         * @name   loadListCompetencies\n         * @param  {Number} templateid\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.loadListCompetencies = function(templateid) {\n            var self = this, ratingtype = 'course';\n\n            if ($(\"#ratinginplanoption\").is(':checked')) {\n                ratingtype = 'plan';\n            } else if ($(\"#ratingincoursemoduleoption\").is(':checked')) {\n                ratingtype = 'coursemodule';\n            }\n\n            var promiselistCompetencies = ajax.call([{\n                methodname: 'core_competency_list_competencies_in_template',\n                args: {\n                    id: templateid\n                }\n            }]);\n            var elementloading = $(\"#submitFilterStatstButton\");\n            elementloading.addClass('loading');\n            promiselistCompetencies[0].then(function(results) {\n                if (results.length > 0) {\n                    var competencies = {competencies_list:results};\n                    return templates.render('report_lpmonitoring/list_competencies_stats', competencies).done(function(html, js) {\n                        $(\"#list-competencies-template\").html(html);\n                        templates.runTemplateJS(js);\n                        elementloading.removeClass('loading');\n                        self.loadCompetenciesDetails(results, templateid, ratingtype);\n                    });\n                } else {\n                    elementloading.removeClass('loading');\n                    return templates.render('report_lpmonitoring/list_competencies_stats', {}).done(function(html, js) {\n                        $(\"#list-competencies-template\").html(html);\n                        templates.runTemplateJS(js);\n                    });\n                }\n            }).fail(\n                function(exp) {\n                    elementloading.removeClass('loading');\n                    notification.exception(exp);\n                }\n            );\n        };\n\n        /**\n         * Get competency detail.\n         *\n         * @name  getCompetencyDetailDeferred\n         * @param {Object} request\n         * @param {Number} templateid\n         * @param {String} ratingtype 'course', 'coursemodule' or 'plan'\n         * @return {Object} promise\n         * @function\n         */\n        LearningplanStats.prototype.getCompetencyDetailDeferred = function(request, templatename, ratingtype) {\n            var self = this;\n            return function() {\n                // Wrap with a deferred.\n                var defer = $.Deferred();\n                var promiserequest = ajax.call(request);\n                promiserequest[0].done(function(context){\n                    var compid = context.competencyid;\n                    // Locally store competency statitstics.\n                    self.competencies[compid].competencydetail = context;\n                    templates.render(templatename, context).done(function(html, js) {\n                        $('#comp-' + compid).removeClass('loading');\n                        $('#comp-' + compid + ' .x_content').html(html);\n                        // Apply Donut Graph to the competency.\n                        var options = {\n                            legend: false,\n                            responsive: false,\n                            tooltips: {enabled: false}\n                        };\n                        var colors = [];\n                        var datascales = [];\n                        var applygraph = false;\n                        if (ratingtype === 'plan' && context.nbuserrated !== 0) {\n                            $.each(context.scalecompetencyitems, function(index, record) {\n                                colors.push(record.color);\n                                datascales.push(record.nbusers);\n                            });\n                            applygraph = true;\n                        }\n                        if ( (ratingtype === 'course' || ratingtype === 'coursemodule') && context.nbratings !== 0) {\n                            $.each(context.scalecompetencyitems, function(index, record) {\n                                colors.push(record.color);\n                                datascales.push(record.nbratings);\n                            });\n                            applygraph = true;\n                        }\n                        if (applygraph === true) {\n                            new Chart($('#canvas-graph-' + compid), {\n                                type: 'doughnut',\n                                data: {\n                                    labels: [],\n                                    datasets: [{\n                                        data: datascales,\n                                        backgroundColor: colors,\n                                        hoverBackgroundColor: []\n                                    }]\n                                },\n                                options: options\n                            });\n                        }\n                        templates.runTemplateJS(js);\n                        self.colorContrast.apply('#comp-' + compid + ' .x_content .tile-stats .badge.cr-scalename');\n                    });\n                    defer.resolve();\n                }).fail(function(exp) {\n                    $(\"#list-competencies-template\").empty();\n                    notification.exception(exp);\n                });\n                // Return a promise so that we can chain properly in the each.\n                return defer.promise();\n            };\n        };\n\n        /**\n         * Load competencies details.\n         *\n         * @name  loadCompetenciesDetails\n         * @param {Object[]} competencies\n         * @param {Number} templateid\n         * @param {String} ratingtype 'course', 'coursemodule' or 'plan'\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.loadCompetenciesDetails = function(competencies, templateid, ratingtype) {\n            var self = this;\n            var servicename = 'report_lpmonitoring_get_competency_statistics';\n            var templatename = 'report_lpmonitoring/competency_detail_stats';\n            if (ratingtype == 'course') {\n                servicename = 'report_lpmonitoring_get_competency_statistics_incourse';\n                templatename = 'report_lpmonitoring/competency_detail_stats_incourse';\n            } else if (ratingtype == 'coursemodule') {\n                servicename = 'report_lpmonitoring_get_competency_statistics_incoursemodules';\n                templatename = 'report_lpmonitoring/competency_detail_stats_incourse';\n            }\n            var base = $.when({});\n            $('.competencyreport .competency-detail').addClass('loading');\n            $.each(competencies, function(index, record) {\n                // Locally store competency information.\n                self.competencies[record.id] = {infocompetency: record};\n                var req = [{\n                    methodname: servicename,\n                    args: {\n                        competencyid: record.id,\n                        templateid: templateid\n                    }\n                }];\n                base = base.then(self.getCompetencyDetailDeferred(req, templatename, ratingtype));\n            });\n        };\n\n        /**\n         * Display the list of users in competency.\n         *\n         * @name   displayScaleUserList\n         * @param  {Array} listusers\n         * @param  {Number} competencyid\n         * @param  {Number} scalevalue\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.displayScaleUserList = function(listusers, competencyid, scalevalue) {\n            var self = this;\n            listusers.competencyid = competencyid;\n            listusers.scalevalue = scalevalue;\n            if (listusers.scalecompetencyitem.listusers.length > 0) {\n                str.get_string('linkedusers', 'report_lpmonitoring').done(\n                function(titledialogue) {\n                    templates.render('report_lpmonitoring/list_users_in_scale_value', listusers)\n                        .done(function(html, js) {\n                            // Show the dialogue.\n                            new Dialogue(\n                                titledialogue,\n                                html,\n                                function() {\n                                    DataTable.apply('#list-user-' + competencyid + '-' + scalevalue, true, true);\n                                },\n                                self.destroyDialogue\n                            );\n                            templates.runTemplateJS(js);\n                            self.colorContrast.apply('.moodle-dialogue-base .badge.cr-scalename');\n                        }).fail(notification.exception);\n                });\n            }\n        };\n\n        /**\n         * Display the list of users in competency.\n         *\n         * @name   displayTotalUserList\n         * @param  {Array} listusers\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.displayTotalUserList = function(listusers) {\n            var self = this;\n            if (listusers.totaluserlist.length > 0) {\n                str.get_string('userlist').done(\n                function(titledialogue) {\n                    templates.render('report_lpmonitoring/list_users_in_competency_stats', listusers)\n                        .done(function(html, js) {\n                            // Show the dialogue.\n                            new Dialogue(\n                                titledialogue,\n                                html,\n                                function(){\n                                    DataTable.apply('#list-users-stats-' + listusers.competencyid, true, true);\n                                },\n                                self.destroyDialogue\n                            );\n                            templates.runTemplateJS(js);\n                        }).fail(notification.exception);\n                });\n            }\n        };\n\n        /**\n         * destroy DOM after close.\n         *\n         * @param Dialogue\n         * @function\n         */\n        LearningplanStats.prototype.destroyDialogue = function(dialg) {\n            dialg.close();\n        };\n\n        /**\n         * Init the differents page blocks and inputs form.\n         *\n         * @name   initPage\n         * @return {Void}\n         * @function\n         */\n        LearningplanStats.prototype.initPage = function() {\n            var self = this;\n            str.get_strings([\n                { key: 'selectlearningplantemplate', component: 'report_lpmonitoring' },\n                { key: 'notemplateselected', component: 'report_lpmonitoring' }]\n            ).done(\n                function (strings) {\n                    // Autocomplete for templates.\n                    autocomplete.enhance(\n                        self.templateSelector,\n                        false,\n                        'report_lpmonitoring/learningplanstats',\n                        strings[0],\n                        false,\n                        true,\n                        strings[1]);\n                }\n            ).fail(notification.exception);\n\n            // Allow collapse of block panels.\n            Toggler.init();\n\n            // Filter form submit.\n            $(document).on('submit', '#statstFilter', function(){\n                self.submitFormHandler();\n                return false;\n            });\n\n            // Handle click on scale number users.\n            $(\".competencyreport\").on('click', 'a.scaleinfo', function(event) {\n                event.preventDefault();\n                var competencyid = $(this).data(\"competencyid\");\n                var scalevalue = $(this).data(\"scalevalue\");\n\n                if (typeof self.competencies[competencyid] !== 'undefined') {\n                    var listusers = {};\n                    var competencydetail = self.competencies[competencyid].competencydetail;\n                    listusers.scalecompetencyitem = competencydetail.scalecompetencyitems[scalevalue - 1];\n                    self.displayScaleUserList(listusers, competencyid, scalevalue);\n                }\n            });\n            // Handle click on total users.\n            $(\".competencyreport\").on('click', 'a.totalnbusers', function(event) {\n                event.preventDefault();\n                var competencyid = $(this).data(\"competencyid\");\n                if (typeof self.competencies[competencyid] !== 'undefined') {\n                    var users = {};\n                    users.totaluserlist = self.competencies[competencyid].competencydetail.totaluserlist;\n                    users.competencyid = competencyid;\n                    self.displayTotalUserList(users);\n                }\n            });\n        };\n\n        return {\n            /**\n             * Main initialisation.\n             *\n             * @return {LearningplanStats}\n             * @method init\n             */\n            init: function() {\n                return new LearningplanStats();\n            },\n            /**\n             * Process result autocomplete for templates.\n             *\n             * @param {type} selector\n             * @param {type} results\n             * @returns {Array}\n             */\n            processResults: function(selector, results) {\n                var templates = [];\n                $.each(results, function(index, template) {\n                    templates.push({\n                        value: template.id,\n                        label: template._label\n                    });\n                });\n                return templates;\n            },\n\n            /**\n             * Transport method for autocomplete for templates.\n             *\n             * @param {type} selector\n             * @param {type} query\n             * @param {type} success\n             * @param {type} failure\n             * @returns {undefined}\n             */\n            transport: function(selector, query, success, failure) {\n                var promise;\n                var contextid = $(selector).data('contextid');\n                if (contextid === '') {\n                    return [];\n                }\n\n                promise = ajax.call([{\n                    methodname: 'report_lpmonitoring_search_templates',\n                    args: {\n                        query: query,\n                        contextid: parseInt(contextid)\n                    }\n                }]);\n\n                promise[0].then(function(results) {\n                    var promises = [],\n                        i = 0;\n\n                    // Render the label.\n                    $.each(results, function(index, template) {\n                        promises.push(templates.render('report_lpmonitoring/form-template-selector-suggestion', template));\n                    });\n\n                    // Apply the label to the results.\n                    return $.when.apply($.when, promises).then(function() {\n                        var args = arguments;\n                        $.each(results, function(index, template) {\n                            template._label = args[i];\n                            i++;\n                        });\n                        success(results);\n                    });\n\n                }, failure);\n            }\n        };\n\n    });\n"],"file":"learningplanstats.min.js"}